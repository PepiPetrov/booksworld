(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[18],{169:function(e,t,n){"use strict";function c(e){return 0===e.length||void 0===e}function i(e,t){return e===t}function o(e,t){return e.length>=t}function r(e){return/^(https:|http:|www\.)\S*/gm.test(e)}function a(e){return/^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/.test(e)}n.d(t,"c",(function(){return c})),n.d(t,"a",(function(){return i})),n.d(t,"d",(function(){return o})),n.d(t,"e",(function(){return r})),n.d(t,"b",(function(){return a}))},205:function(e,t,n){e.exports={"grey-text":"Details_grey-text__2TyhD"}},228:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return I}));var c=n(37),i=n(5),o=n(0),r=n(53),a=n(165),s=n(147),u=n(3),j=n(9),l=n(38),b=n(182),d=n(145),O=n(161),h=n(162),f=n(169),m=n(109),g=n(205),x=n.n(g),v=n(8),k=n(2),p=n(158),y=n(1);function w(e){var t=e.comment,n=e.setComments,c=e.bookId,a=Object(o.useState)(!1),s=Object(i.a)(a,2),u=s[0],j=s[1];return Object(y.jsxs)("div",{children:[Object(y.jsx)("p",{children:t.content}),t.creator===localStorage.getItem("username")?Object(y.jsxs)("div",{children:[u?Object(y.jsx)(r.a,{variant:"warning",onClick:function(e){return j(!1)},children:"Hide edit"}):Object(y.jsx)(r.a,{variant:"warning",onClick:function(e){return j(!0)},children:"Show edit"}),"  ",Object(y.jsx)(r.a,{variant:"danger",onClick:function(){Object(b.confirm)("Arey you sure you want to remove the comment?").then((function(e){e&&Object(p.f)(t._id).then((function(e){Object(p.d)(c).then((function(e){n(e)}))}))}))},children:"Remove comment"}),u?Object(y.jsx)(S,{comment:t,setComments:n,bookId:c,setShowEdit:j}):null]}):null]})}function S(e){var t=e.setComments,n=e.bookId,c=e.comment,a=e.setShowEdit,u=Object(o.useState)({content:c.content}),j=Object(i.a)(u,2),l=j[0],b=j[1],d=Object(o.useState)({}),O=Object(i.a)(d,2),h=O[0],f=O[1],m=function(){var e={},t=l.content;return void 0!==t&&0!==t.length||(e.content="Content is required!"),e};return Object(y.jsxs)(s.a,{style:{marginTop:"5%"},onSubmit:function(e){e.preventDefault();var i=m();Object.keys(i).length>0?f(i):Object(p.b)(l,c._id).then((function(e){Object(p.d)(n).then((function(e){t(e),a(!1)}))}))},children:[Object(y.jsxs)(s.a.Group,{children:[Object(y.jsx)(s.a.Label,{children:"Comment content"}),Object(y.jsx)(s.a.Control,{placeholder:"Content",defaultValue:c.content,onChange:function(e){return t="content",n=e.target.value,b(Object(k.a)(Object(k.a)({},l),{},Object(v.a)({},t,n))),void(h[t]&&f(Object(k.a)(Object(k.a)({},h),{},Object(v.a)({},t,null))));var t,n},isInvalid:!!h.content})]}),Object(y.jsx)(r.a,{type:"submit",style:{marginTop:"5%"},children:"Edit comment"})]})}var C=function(e){var t=e.bookId,n=Object(o.useState)([]),c=Object(i.a)(n,2),a=c[0],u=c[1],j=Object(o.useState)(!0),l=Object(i.a)(j,2),b=l[0],d=l[1],O=Object(o.useState)({}),h=Object(i.a)(O,2),f=h[0],m=h[1],g=Object(o.useState)({}),x=Object(i.a)(g,2),S=x[0],C=x[1];Object(o.useEffect)((function(){return b&&Object(p.d)(t).then((function(e){u(e)})),function(){d(!1)}}),[b,t]);var I=function(){var e={},t=f.content;return void 0===t&&0===t.length&&(e.content="Content is required!"),e};return Object(y.jsxs)("div",{className:"align-items-center",style:{marginTop:"5%"},children:[a.length>0?a.map((function(e){return Object(y.jsx)(w,{comment:e,setComments:u,bookId:t},e._id)})):Object(y.jsx)("p",{children:"No comments"}),localStorage.getItem("token")?Object(y.jsxs)(s.a,{onSubmit:function(e){e.preventDefault();var n=I();Object.keys(n).length>0?C(n):Object(p.a)(f,t).then((function(e){u(e)}))},style:{marginTop:"5%",width:"50%",marginLeft:"26%"},children:[Object(y.jsxs)(s.a.Group,{children:[Object(y.jsx)(s.a.Control,{as:"textarea",onChange:function(e){return t="content",n=e.target.value,m(Object(k.a)(Object(k.a)({},f),{},Object(v.a)({},t,n))),void(S[t]&&C(Object(k.a)(Object(k.a)({},S),{},Object(v.a)({},t,null))));var t,n},placeholder:"Comment",isInvalid:!!S.content}),Object(y.jsx)(s.a.Control.Feedback,{type:"invalid",children:S.content})]}),Object(y.jsx)(r.a,{type:"submit",style:{marginTop:"5%"},children:"Create comment"})]}):null]})};function I(){var e=Object(l.c)((function(e){return e.user})),t=Object(o.useContext)(m.a).login,n=Object(o.useState)({}),s=Object(i.a)(n,2),O=s[0],g=s[1],v=Object(o.useState)(!1),k=Object(i.a)(v,2),p=k[0],w=k[1],S=Object(o.useState)(0),I=Object(i.a)(S,2),A=I[0],L=I[1],D=Object(o.useState)(!0),E=Object(i.a)(D,2),N=E[0],R=E[1],z=Object(o.useState)(""),G=Object(i.a)(z,2),Z=G[0],q=G[1],B=Object(o.useState)(!0),J=Object(i.a)(B,2),F=J[0],H=J[1],P=Object(u.h)().id,V=Object(u.g)();return Object(o.useEffect)((function(){return N&&Object(d.g)(P).then((function(t){if(t.genres=t.genres.join(", "),void 0!==t.likes&&t.likes.includes(e.username)&&w(!0),void 0!==t.ratings){var n,i=0,o=Object(c.a)(t.ratings);try{for(o.s();!(n=o.n()).done;){var r=n.value;i+=Number(r.rating)}}catch(a){o.e(a)}finally{o.f()}L(i/t.ratings.length)}return g(t),t})).then((function(e){Object(h.c)(e._id).then((function(e){q(e),H(!1)}))})),function(){R(!1)}}),[P,e,N]),Object(y.jsxs)("div",{className:"text-center ".concat(x.a["grey-text"]),style:{marginTop:"1%"},children:[Object(y.jsxs)("p",{children:["Title: ",O.title]}),Object(y.jsxs)("p",{children:["Author: ",O.author]}),Object(y.jsxs)("p",{children:["Created by ",Object(y.jsx)(j.b,{to:"/user/".concat(O.creator),children:O.creator})]}),F?Object(y.jsx)("p",{children:"Image is loading ... Please wait"}):Object(y.jsx)(a.a,{src:Z,alt:"No image",style:{width:"40%"}}),Object(y.jsxs)("div",{children:[Object(y.jsx)("p",{children:"Description: "}),Object(y.jsx)("p",{style:{wordBreak:"break-all",width:"50%",marginLeft:"25%"},children:O.description})]}),Object(y.jsxs)("p",{children:["This book is published in ",O.year]}),O.series?Object(y.jsxs)("p",{children:["This is the ",O.seriesRow,"th book of the series ",Object(y.jsx)(r.a,{href:"/series/".concat(O.series),children:O.series})]}):null,Object(y.jsxs)("p",{children:["Genres: ",O.genres]}),Object(f.e)(O.buyLink)?Object(y.jsxs)("p",{children:["Buy the book from the link here: ",Object(y.jsx)(r.a,{href:O.buyLink,target:"_blank",children:O.buyLink})]}):Object(y.jsx)("p",{children:"No buy link"}),void 0!==O.ratings?Object(y.jsxs)("p",{children:["Average rating: ",A]}):null,localStorage.getItem("token")?Object(y.jsx)(_,{bookId:O._id}):null,localStorage.getItem("token")?Object(y.jsx)(T,{book:O}):null,Object(y.jsx)("br",{}),e.username===O.creator?Object(y.jsxs)("div",{children:[Object(y.jsx)(r.a,{href:"/edit/".concat(O._id),variant:"warning",children:"Edit book"}),"  ",Object(y.jsx)(r.a,{onClick:function(e){return function(e,t){Object(b.confirm)("Are you sure you want to remove the book?").then((function(n){n&&Object(d.m)(e).then((function(e){t("/books/all")}))}))}(O._id,V)},variant:"danger",children:"Remove book"})]}):null,O.likes&&O.likes.length>0?Object(y.jsxs)("p",{children:["This book has ",O.likes.length," like",O.likes.length>1?"s":""]}):null,e.username!==O.creator&&null!==e.username&&!1===p?Object(y.jsx)(r.a,{onClick:function(e){return function(e,t){Object(d.l)(e,t).then((function(){window.location.reload()}))}(O._id,t)},style:{marginTop:"5%"},children:"Like"}):null,p?Object(y.jsx)(r.a,{onClick:function(e){return t=O._id,void Object(b.confirm)("Are you sure you want to dislike the book?").then((function(e){e&&Object(d.d)(t).then((function(){window.location.reload()}))}));var t},children:"Dislike"}):null,Object(y.jsx)("h4",{children:"Comments"}),Object(y.jsx)(C,{bookId:P})]})}function T(e){var t=e.book,n=Object(o.useState)(1),c=Object(i.a)(n,2),a=c[0],u=c[1],j=function(e){e.preventDefault(),Object(d.a)(t._id,a).then((function(){window.location.reload()}))};return void 0!==t.ratings&&0===t.ratings.filter((function(e){return e.username===localStorage.getItem("username")})).length?Object(y.jsxs)(s.a,{onSubmit:j,style:{marginTop:"5%"},children:[Object(y.jsx)(s.a.Control,{type:"number",max:"10",min:"1",onChange:function(e){return u(e.target.value)}}),Object(y.jsx)(r.a,{type:"submit",children:"Submit rating"})]}):void 0===t.ratings?Object(y.jsxs)(s.a,{onSubmit:j,style:{marginTop:"5%",width:"50%",marginLeft:"26%"},children:[Object(y.jsx)(s.a.Control,{type:"number",max:"10",min:"1",onChange:function(e){return u(e.target.value)}}),Object(y.jsx)(r.a,{type:"submit",style:{marginTop:"5%"},children:"Submit rating"})]}):null}function _(e){var t=e.bookId,n=Object(o.useState)([]),c=Object(i.a)(n,2),a=c[0],s=c[1],u=Object(o.useState)(!0),j=Object(i.a)(u,2),l=j[0],b=j[1];Object(o.useEffect)((function(){return l&&Object(O.d)().then((function(e){s(e)})),function(){b(!1)}}),[l]),console.log(a);return a!==[]&&a.includes(t)?Object(y.jsx)(r.a,{onClick:function(){Object(d.n)(t).then((function(e){window.location.reload()}))},children:"Remove from favourites"}):Object(y.jsx)(r.a,{onClick:function(){Object(d.b)(t).then((function(){window.location.reload()}))},children:"Add to favourites"})}}}]);
//# sourceMappingURL=18.1ec67d01.chunk.js.map